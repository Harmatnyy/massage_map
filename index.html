<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <title>Massage Map (Full-width Map + Cards at Bottom + Tooltip Hover)</title>

  <!-- Адаптивність -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Bootstrap CSS -->
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css"
  />
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap-theme.min.css"
  />

  <!-- Font Awesome -->
  <link
    rel="stylesheet"
    href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css"
  />

  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.css"
  />

  <!-- MarkerCluster CSS (для групування маркерів) -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css"
  />
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css"
  />

  <!-- AwesomeMarkers (якщо потрібні іконки) -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css"
  />

  <style>
    /* Скидання відступів */
    html, body {
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
    }

    /* Карта зверху (займає весь екран за мінусом блоку для карток) */
    #map {
      width: 100%;
      height: calc(100vh - 264px); /* висота: все вікно - 250px */
    }

    /* Контейнер для карток унизу (горизонтальна прокрутка) */
    #contact-list {
      width: 100%;
      height: 264px;
      overflow-x: auto; /* Горизонтальна прокрутка */
      white-space: nowrap; /* Щоб картки не переносилися */
      background-color: #f8f8f8;
      box-sizing: border-box;
      padding: 10px;
    }

    /* Картки з інформацією про масажистів */
    .contact-card {
      display: inline-block;
      width: 250px;
      height: 100%;     /* картка по всій висоті контейнера */
      margin: 0 5px;    /* Зменшили відступи між картками */
      vertical-align: top;
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      white-space: normal; /* Дозволяє переносити текст у кілька рядків */
    }

    .contact-card h4 {
      margin-top: 0;
      margin-bottom: 10px;
    }

    /* Стиль кнопок (робимо текст білим) */
    .btn-primary,
    .btn-success {
      color: #fff !important;
    }

    /* Розмір шрифту у попапі */
    .leaflet-popup-content {
      font-size: 12px; 
    }

    /* Анімація тултіпу (збільшення при наведенні) */
    .leaflet-tooltip {
      transition: transform 0.2s ease-in-out, font-size 0.2s ease-in-out;
      font-size: 100%;
    }
    .leaflet-tooltip:hover {
      transform: scale(2);
      font-size: 200%;
    }
  </style>
</head>
<body>

  <!-- Карта -->
  <div id="map"></div>

  <!-- Блок карток унизу -->
  <div id="contact-list"></div>

  <!-- JS бібліотеки -->
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.3/dist/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js"></script>

  <script>
    // Дані про масажистів/центри
    var places = [
      {
        name: "Женя массажист",
        lat: 50.425,
        lon: 30.520,
        address: "Палац Україна",
        price: "800-1000 грн за 2-3 години",
        desc: "Банки, стимуляції, спортивний.",
        contact_type: "phone",
        contact_value: "+380504400094"
      },
      {
        name: "Масаж м. Арсенальна",
        lat: 50.4406,
        lon: 30.5472,
        address: "Арсенальна або СмартМедікал на Маккейна",
        price: "",
        desc: "Остеопатичний масаж (Вітрук)",
        contact_type: "phone",
        contact_value: "+380936226390"
      },
      {
        name: "ELITE MASSAGE",
        lat: 50.5123,
        lon: 30.4989,
        address: "ТРЦ DREAM 1 yellow, Оболонський проспект, 1Б, 3 поверх",
        price: "",
        desc: "",
        contact_type: "link",
        contact_value: "https://www.instagram.com/alexandr__morgun"
      },
      {
        name: "Юрій",
        lat: 50.4144,
        lon: 30.5360,
        address: "Profesora Pidvysots'koho St, 6В",
        price: "",
        desc: "",
        contact_type: "phone",
        contact_value: "+380931349757"
      },
      {
        name: "Владислав Реабілітолог",
        lat: 50.4506,
        lon: 30.4640,
        address: "КПІ",
        price: "",
        desc: "",
        contact_type: "phone",
        contact_value: "+380997584948"
      },
      {
        name: "Iryna Lysenko",
        lat: 50.4448,
        lon: 30.5106,
        address: "бул. Тараса Шевченка 46а",
        price: "",
        desc: "",
        contact_type: "link",
        contact_value: "https://www.instagram.com/massageirynalysenko"
      },
      {
        name: "Остеопатія та Пілатес",
        lat: 50.4505,
        lon: 30.5048,
        address: "Вул. О.Гончара 26, Київ",
        price: "Графік: 10:00 - 21:00",
        desc: "",
        contact_type: "link",
        contact_value: "https://w.wlaunch.net/i/tronka.gonchara/b/fd01fdf0-b209-11ee-9635-a72d342f2634/s"
      },
      {
        name: "МАСАЖ КИЇВ - Палац спорту",
        lat: 50.4376,
        lon: 30.5204,
        address: "вулиця Шота Руставелі, 33А",
        price: "",
        desc: "",
        contact_type: "phone",
        contact_value: "+380737857575"
      },
      {
        name: "PhysioKey",
        lat: 50.4468,
        lon: 30.5070,
        address: "Bohdana Khmel'nyts'koho St, 59, Kyiv, Ukraine 02000",
        price: "",
        desc: "",
        contact_type: "link",
        contact_value: "https://n818324.alteg.io/company/768564/personal/menu?o="
      }
    ];

    // Створюємо мапу
    var map = L.map('map', {
      center: [50.4501, 30.5234],
      zoom: 12
    });

    // НЕОФІЦІЙНИЙ Google Tiles (увага: можуть не працювати або порушувати TOS)
    var googleLayer = L.tileLayer('http://{s}.google.com/vt/lyrs=m&x={x}&y={y}&z={z}', {
      maxZoom: 20,
      subdomains:['mt0','mt1','mt2','mt3']
    }).addTo(map);

    // Кластер маркерів
    var markerCluster = L.markerClusterGroup();

    // Допоміжна функція для створення кнопок
    function buildContactButton(type, value) {
      if (type === "phone") {
        return "<a href='tel:" + value + "' class='btn btn-primary' target='_blank'>Зателефонувати</a>";
      } else if (type === "link") {
        return "<a href='" + value + "' class='btn btn-success' target='_blank'>Записатися</a>";
      }
      return "";
    }

    // Формуємо вміст попапа (як у карток)
    function buildPopup(place) {
      var button = buildContactButton(place.contact_type, place.contact_value);

      var content = "<h4>" + place.name + "</h4>";
      if (place.address) {
        content += "<p><strong>Адреса:</strong> " + place.address + "</p>";
      }
      if (place.price) {
        content += "<p><strong>Ціна/графік:</strong> " + place.price + "</p>";
      }
      if (place.desc) {
        content += "<p><strong>Опис:</strong> " + place.desc + "</p>";
      }
      content += button;

      return content;
    }

    // Короткий тултіп (лише назва)
    function buildTooltip(place) {
      return "<b>" + place.name + "</b>";
    }

    // Додаємо маркери у кластер
    places.forEach(function(p) {
      var marker = L.marker([p.lat, p.lon], {
        icon: L.AwesomeMarkers.icon({
          icon: 'info-sign',
          markerColor: 'gray',
          prefix: 'glyphicon',
          iconColor: 'white'
        })
      });

      marker.bindPopup(buildPopup(p), { maxWidth: "auto" });
      marker.bindTooltip(buildTooltip(p));

      markerCluster.addLayer(marker);
    });

    // Додаємо кластер на мапу
    map.addLayer(markerCluster);

    // Створюємо картки внизу
    var contactListContainer = document.getElementById("contact-list");

    places.forEach(function(place) {
      var cardDiv = document.createElement("div");
      cardDiv.className = "contact-card";

      // Базовий HTML
      var cardHTML = "<h4>" + place.name + "</h4>";

      if (place.address) {
        cardHTML += "<p><strong>Адреса:</strong> " + place.address + "</p>";
      }
      if (place.price) {
        cardHTML += "<p><strong>Ціна/Графік:</strong> " + place.price + "</p>";
      }
      if (place.desc) {
        cardHTML += "<p><strong>Опис:</strong> " + place.desc + "</p>";
      }

      // Якщо це телефон, показуємо його у тексті (в додаток до кнопки)
      if (place.contact_type === "phone") {
        cardHTML += "<p><strong>Телефон:</strong> " + place.contact_value + "</p>";
      }

      // Додаємо кнопку (телефон/лінк)
      cardHTML += buildContactButton(place.contact_type, place.contact_value);

      cardDiv.innerHTML = cardHTML;
      contactListContainer.appendChild(cardDiv);
    });
  </script>
</body>
</html>
