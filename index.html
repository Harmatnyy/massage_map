<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <title>Massage Map with Masonry Layout</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Bootstrap CSS (v3) -->
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css"
  />
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap-theme.min.css"
  />

  <!-- Font Awesome (для іконок) -->
  <link
    rel="stylesheet"
    href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
  />

  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.css"
  />

  <!-- Leaflet MarkerCluster CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css"
  />
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css"
  />

  <!-- Leaflet AwesomeMarkers CSS -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css"
  />

  <style>
    /* Скидаємо відступи браузера */
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
    }

    /* Карта вгорі – займає 60% висоти вікна */
    #map {
      width: 100%;
      height: 60vh;
    }

    /* Контейнер для Masonry-карток внизу */
    .container {
      margin-top: 20px;
    }
    .grid {
      margin: 0 auto;
      max-width: 1140px; /* Приклад, можна зробити 100% */
    }

    /* Кожна “цеглинка” (картка) Masonry */
    .grid-item {
      width: 300px;           /* Фіксована ширина (або використайте grid-sizer) */
      margin-bottom: 20px;    /* Відступ знизу */
      display: inline-block;
      vertical-align: top;
    }

    /* Оформлення панелей Bootstrap */
    .panel {
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    .panel-body {
      padding: 15px;
    }

    /* Легкий ефект при наведенні на картку */
    .grid-item:hover {
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      border-radius: 8px;
      border: 1px solid #008cff;
      transform: translateY(-2px);
      transition: all 0.2s ease;
      cursor: pointer;
    }
    /* Збільшуємо розмір тексту в абзацах попапу */
.leaflet-popup-content p {
  font-size: 13px; /* оберіть бажаний розмір */
  line-height: 1.2; /* трішки збільшимо міжрядковий інтервал, за потреби */
}

/* Робимо текст у кнопці білим */
.leaflet-popup-content a.btn {
  color: #fff !important;  /* важливо перебити базовий колір Bootstrap */
}    
/* Заголовок усередині попапу */
.leaflet-popup-content h4 {
  font-size: 16px;      /* Розмір шрифту для заголовка */
  margin: 0 0 10px;     /* Відступи зверху/знизу */
  color: #333;          /* Колір тексту */
}
  </style>
</head>
<body>

  <!-- Карта -->
  <div id="map"></div>

  <!-- Masonry-контейнер для карток -->
  <div class="container">
    <div class="grid" id="cards-container">
      <!-- Картки буде додавати JS -->
    </div>
  </div>

  <!-- JS: jQuery, Bootstrap, Leaflet, Masonry -->
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.3/dist/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js"></script>
  <!-- Підключаємо Masonry -->
  <script src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js"></script>
  <!-- imagesLoaded (необов’язково, для випадку з зображеннями) -->
  <!-- <script src="https://unpkg.com/imagesloaded@4/imagesloaded.pkgd.min.js"></script> -->

  <script>
    // Прикладові дані з координатами
    var places = [
      {
        name: "Женя массажист",
        lat: 50.425,
        lon: 30.520,
        address: "Палац Україна",
        price: "800-1000 грн за 2-3 години",
        desc: "Банки, стимуляції, розслабляючий, спортивний, лікуючий.",
        contact_type: "phone",
        contact_value: "+380504400094"
      },
      {
        name: "Масаж м. Арсенальна",
        lat: 50.4406,
        lon: 30.5472,
        address: "Арсенальна або СмартМедікал на Маккейна",
        price: "",
        desc: "Остеопатичний масаж (Вітрук)",
        contact_type: "phone",
        contact_value: "+380936226390"
      },
      {
        name: "ELITE MASSAGE",
        lat: 50.5123,
        lon: 30.4989,
        address: "ТРЦ DREAM 1 yellow, Оболонський проспект, 1Б, 3 поверх",
        desc: "",
        contact_type: "link",
        contact_value: "https://www.instagram.com/alexandr__morgun"
      },
      {
        name: "Юрій",
        lat: 50.4144,
        lon: 30.5360,
        address: "Profesora Pidvysots'koho St, 6В",
        desc: "",
        contact_type: "phone",
        contact_value: "+380931349757"
      },
      {
        name: "Владислав Реабілітолог",
        lat: 50.4506,
        lon: 30.4640,
        address: "КПІ",
        desc: "",
        contact_type: "phone",
        contact_value: "+380997584948"
      },
      {
        name: "Iryna Lysenko",
        lat: 50.4448,
        lon: 30.5106,
        address: "бул. Тараса Шевченка 46а",
        desc: "",
        contact_type: "link",
        contact_value: "https://www.instagram.com/massageirynalysenko"
      },
      {
        name: "Остеопатія та Пілатес",
        lat: 50.4505,
        lon: 30.5048,
        address: "Вул. О.Гончара 26, Київ",
        price: "Графік: 10:00 - 21:00",
        desc: "",
        contact_type: "link",
        contact_value: "https://w.wlaunch.net/i/tronka.gonchara/b/fd01fdf0-b209-11ee-9635-a72d342f2634/s"
      },
      {
        name: "МАСАЖ КИЇВ - Палац спорту",
        lat: 50.4376,
        lon: 30.5204,
        address: "вулиця Шота Руставелі, 33А",
        desc: "",
        contact_type: "phone",
        contact_value: "+380737857575"
      },
      {
        name: "PhysioKey",
        lat: 50.4468,
        lon: 30.5070,
        address: "Bohdana Khmel'nyts'koho St, 59, Kyiv, Ukraine 02000",
        desc: "",
        contact_type: "link",
        contact_value: "https://n818324.alteg.io/company/768564/personal/menu?o="
      }
    ];

    // Ініціалізація карти
    var map = L.map('map').setView([50.4501, 30.5234], 12);

    // (Неофіційний) шар Google Maps
    var googleLayer = L.tileLayer('http://{s}.google.com/vt/lyrs=m&x={x}&y={y}&z={z}', {
      maxZoom: 20,
      subdomains:['mt0','mt1','mt2','mt3']
    }).addTo(map);

    // MarkerCluster
    var markerCluster = L.markerClusterGroup();

    // Функція іконки за типом контакту
    function getIconByType(type) {
      var iconName, markerColor;
      switch(type) {
        case 'phone':
          iconName = 'fa-phone';
          markerColor = 'blue';
          break;
        case 'link':
          iconName = 'fa-link';
          markerColor = 'green';
          break;
        default:
          iconName = 'fa-map-marker';
          markerColor = 'red';
      }
      return L.AwesomeMarkers.icon({
        icon: iconName,
        prefix: 'fa',
        markerColor: markerColor,
        iconColor: 'white'
      });
    }

    // Побудова попапу
    function buildPopup(place) {
      var content = "<h4>" + place.name + "</h4>";
      if (place.address) {
        content += "<p><strong>Адреса:</strong> " + place.address + "</p>";
      }
      if (place.price) {
        content += "<p><strong>Ціна/графік:</strong> " + place.price + "</p>";
      }
      if (place.desc) {
        content += "<p><strong>Опис:</strong> " + place.desc + "</p>";
      }
      // Кнопка (телефон або лінк)
      if (place.contact_type === "phone") {
        content += "<p><a href='tel:" + place.contact_value
                 + "' class='btn btn-primary' target='_blank'><i class='fa fa-phone'></i> Дзвінок</a></p>";
      } else if (place.contact_type === "link") {
        content += "<p><a href='" + place.contact_value
                 + "' class='btn btn-success' target='_blank'><i class='fa fa-link'></i> Записатися</a></p>";
      }
      return content;
    }

    // Зберігатимемо place+marker
    var placeMarkers = [];

    places.forEach(function(p) {
      var marker = L.marker([p.lat, p.lon], {
        icon: getIconByType(p.contact_type)
      }).bindPopup(buildPopup(p), { maxWidth: 280 });

      markerCluster.addLayer(marker);
      placeMarkers.push({ place: p, marker: marker });
    });

    map.addLayer(markerCluster);

    // -------- Masonry-картки --------
    var container = document.getElementById("cards-container");

    places.forEach(function(place, idx) {
      // Створюємо .grid-item panel
      var itemDiv = document.createElement("div");
      itemDiv.className = "grid-item panel panel-default";

      var panelBody = document.createElement("div");
      panelBody.className = "panel-body";

      var html = "<h4>" + place.name + "</h4>";
      if (place.address) {
        html += "<p><strong>Адреса:</strong> " + place.address + "</p>";
      }
      if (place.price) {
        html += "<p><strong>Ціна/графік:</strong> " + place.price + "</p>";
      }
      if (place.desc) {
        html += "<p><strong>Опис:</strong> " + place.desc + "</p>";
      }
      if (place.contact_type === "phone") {
        html += "<p><strong>Телефон:</strong> " + place.contact_value + "</p>";
        html += "<p><a href='tel:" + place.contact_value
              + "' class='btn btn-primary' target='_blank'><i class='fa fa-phone'></i> Дзвінок</a></p>";
      } else if (place.contact_type === "link") {
        html += "<p><a href='" + place.contact_value
              + "' class='btn btn-success' target='_blank'><i class='fa fa-link'></i> Записатися</a></p>";
      }

      panelBody.innerHTML = html;
      itemDiv.appendChild(panelBody);

      // Клік на картці => фокус на маркері, попап
      itemDiv.addEventListener("click", function() {
        var marker = placeMarkers[idx].marker;
        map.flyTo(marker.getLatLng(), 15);
        marker.openPopup();
      });

      container.appendChild(itemDiv);
    });

    // Ініціалізуємо Masonry
    var grid = document.querySelector('.grid');
    var msnry = new Masonry(grid, {
      itemSelector: '.grid-item',
      columnWidth: '.grid-item',
      percentPosition: true,
      gutter: 15
    });

    // Якщо є зображення, варто підключити imagesLoaded та викликати:
    // imagesLoaded(grid, function() {
    //   msnry.layout();
    // });
  </script>
</body>
</html>
